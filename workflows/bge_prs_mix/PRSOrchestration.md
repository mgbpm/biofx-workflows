# BGE-PRS Orchestration Workflow

This workflow combines GLIMPSE and PRS WDLs to determine risk scores and percentiles of individuals for a certain disease and model(s).

## GLIMPSE Input Parameters

| Type | Name | Req'd | Description | Default Value |
| :--- | :--- | :---: | :--- | :--- |
| File | glimpse_reference_chunks | Required if running GLIMPSE imputation is desired | | |
| Array[File] | input_crams | Required if running GLIMPSE imputation is desired | Sample input CRAMs to run through GLIMPSE imputation | |
| Array[File] | input_crai | Required if running GLIMPSE imputation is desired | Sample input CRAM indices to run through GLIMPSE imputation; must be in same order as input_crams | |
| Array[String] | sample_ids | Yes | Sample ids for samples in input_crams | |
| Boolean | impute_reference_only_variants | No | | false |
| Boolean | call_indels | No | | false |
| Int | n_burnin | No | | |
| Int | n_main | No | | |
| Int | effective_population_size | No | | |
| Boolean | collect_glimpse_qc | No | Whether or not to collect qc metrics when running GLIMPSE imputation | true |
| String | glimpse_docker_image | No | Docker image for running GLIMPSE imputation | "us.gcr.io/broad-dsde-methods/glimpse:odelaneau_e0b9b56" |
| String | glimpse_extract_docker_image | No | Docker image to get the number of sites in a GLIMPSE reference chunnk | "us.gcr.io/broad-dsde-methods/glimpse_extract_num_sites_from_reference_chunks:michaelgatzen_edc7f3a" |
| File | glimpse_monitoring_script | No | Script to monitor GLIMPSE imputation | |
| File | ref_fasta | Required if running GLIMPSE imputation is desired | HG38 reference FASTA file | |
| File | ref_fai | Required if running GLIMPSE imputation is desired | HG38 reference FASTA index file | |
| File | reference_dict | Required if running GLIMPSE imputation is desired | HG38 Reference dict file | |

## PRS Input Parameters

| Type | Name | Req'd | Description | Default Value |
| :--- | :--- | :---: | :--- | :--- |
| Array[File] | condition_zip_files | Yes | Array of TAR files, where each TAR contains the variant weights files, score weight file, population loadings file, population meansd file, and population pc file for each condition/disease | |
| File | condition_yaml | Yes | YAML file with condition-specific data on bins, thresholds, etc. | |
| File | pruning_sites_for_pca | Required if running PCA after PRS is desired | Pruning sites used in PCA to generate the ancestry adjustment model | |
| String | ubuntu_docker_image | No | Ubunutu Docker image | "ubuntu:21.10" |
| String | python_docker_image | No | Python Docker image | "python:3.11" |
| String | interaction_docker_image | No | Docker image for use of Python | us.gcr.io/broad-dsde-methods/imputation_interaction_python@sha256:40a8fb88fe287c3e3a11022ff63dae1ad5375f439066ae23fe089b2b61d3222e |
| String | plink_docker_image | No | Docker image for Plink 2 | us.gcr.io/broad-dsde-methods/plink2_docker@sha256:4455bf22ada6769ef00ed0509b278130ed98b6172c91de69b5bc2045a60de124 |
| String | flash_pca_docker_image | No | Docker image for running flask PCA | us.gcr.io/broad-dsde-methods/flashpca_docker@sha256:2f3ff1614b00f9c8f271be85fd8875fbddccb7566712b537488d14a2526ccf7f |

## Debugging Options

For debugging purposes, there are several boolean values that can be used to turn on/off modules within the workflow. Input files necessary to help with debugging can be generated by running the module WDLs separately, outside of the orchestration workflow.

| Type | Name | Req'd | Description | Default Value |
| :--- | :--- | :---: | :--- | :--- |
| Boolean | run_glimpse | No | Whether or not to run GLIMPSE imputation | true |
| Boolean | run_scoring | No | Whether or not to find PRS raw scores | true |
| Boolean | run_mix_scoring | No | Whether or not to calculate PRS mix raw score | true |
| Boolean | run_pca | No | Whether or not to run PCA with PRS results | true |
| Boolean | run_adjustment | No | Whether or not adjust PRS raw scores | true |
| Boolean | run_summary | No | Whether or not to find the percentile or bin category of samples' PRS scores | true |
| File | input_vcf | Required if not running GLIMPSE | VCF with samples to substitute for GLIMPSE VCF output | |
| File | pc_projections | Required if not running PCA | PCA projections to substitute for PCA workflow output | |
| File | input_scores | Required if not running PRS raw scores or PRS mix raw scores | PRS scores (raw, mix, or adjusted) | |

## Output Parameters

| Type | Name | When | Description |
| :--- | :--- | :--- | :--- |
| File | glimpse_vcf | If run_glimpse is true | Output imputed VCF from running GLIMPSE |
| File | glimpse_vcf_index | If run_glimpse is true | Output imputer VCF index from running GLIMPSE |
| File | glimpse_qc_metrics | If run_glimpse is true and when collect_glimpse_qc = "true" | QC metrics from running GLIMPSE |
| Array[File] | glimpse_phase_monitoring | If run_glimpse is true | |
| File | glimpse_ligate_monitoring | If run_glimpse is true | |
| Array[File] | prs_raw_scores | If run_scoring is true | PRS raw scores |
| File | prs_mix_raw_score | If run_mix_scoring is true | PRS mix raw scores |
| File | prs_adjusted_score | If run_adjustment is true | PRS scores or mix scores adjusted with population models |
| File | pc_projection | If run_pca is true | PCA projection array |
| File | pc_plot | If run_pca is true | PCA plot from projection array |
