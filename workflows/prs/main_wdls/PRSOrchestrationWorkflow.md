# PRS Mix Orchestration Workflow

This workflow combines GLIMPSE and PRS WDLs to determine risk scores and percentiles of individuals for a certain disease and model(s). The workflow is designed for single sample input. The model manifests used for each desired condition in the assay are to be generated before running this workflow using the MakeAdjustmentModelWorkflow WDL. It is also recommended that the inputs for running the model -- and thus those consequently used in this workflow -- are cleaned using the PreparePrsMixInputsWorkflow WDL to ensure no errors occur when using flashpca.

## GLIMPSE Input Parameters

| Type | Name | Req'd | Description | Default Value |
| :--- | :--- | :---: | :--- | :--- |
| File | glimpse_reference_chunks | Required if running GLIMPSE imputation is desired | | |
| File | input_cram | Required if running GLIMPSE imputation is desired | Sample input CRAM to run through GLIMPSE imputation | |
| File | input_crai | Required if running GLIMPSE imputation is desired | Sample input CRAM index to run through GLIMPSE imputation| |
| String | sample_id | Required if running GLIMPSE imputation is desired | Sample id for sample in input_cram | |
| Boolean | impute_reference_only_variants | No | | false |
| Boolean | call_indels | No | | false |
| Int | n_burnin | No | | |
| Int | n_main | No | | |
| Int | effective_population_size | No | | |
| Boolean | collect_glimpse_qc | No | Whether or not to collect qc metrics when running GLIMPSE imputation | true |
| String | glimpse_docker_image | No | Docker image for running GLIMPSE imputation | "us.gcr.io/broad-dsde-methods/glimpse:odelaneau_e0b9b56" |
| String | glimpse_extract_docker_image | No | Docker image to get the number of sites in a GLIMPSE reference chunnk | "us.gcr.io/broad-dsde-methods/glimpse_extract_num_sites_from_reference_chunks:michaelgatzen_edc7f3a" |
| File | glimpse_monitoring_script | No | Script to monitor GLIMPSE imputation | |
| File | ref_fasta | Required if running GLIMPSE imputation is desired | HG38 reference FASTA file | |
| File | ref_fai | Required if running GLIMPSE imputation is desired | HG38 reference FASTA index file | |
| File | reference_dict | Required if running GLIMPSE imputation is desired | HG38 Reference dict file | |

## PRS Input Parameters

| Type | Name | Req'd | Description | Default Value |
| :--- | :--- | :---: | :--- | :--- |
| String | subject_id | Yes | Subject ID to match the input sample ID | |
| String | prs_test_code | Yes | Test code that defines config files and assay | |
| Array[File] | condition_model_manifests | Yes | Adjustment model manifest file from MakeAdjustmentModelWorkflow WDL | |
| File | conditions_config | Yes | TSV file with condition-specific data on bins, odds-ratios, codes, etc. | |
| String | prs_docker_image | No | Docker image with PRS scripts | "us-central1-docker.pkg.dev/mgb-lmm-gcp-infrast-1651079146/mgbpmbiofx/prs:20250122" |

## Debugging Options

For debugging purposes, there are several boolean values that can be used to turn on/off modules within the workflow. Input files necessary to help with debugging can be generated by running the module WDLs separately, outside of the orchestration workflow.

| Type | Name | Req'd | Description | Default Value |
| :--- | :--- | :---: | :--- | :--- |
| Boolean | run_glimpse | No | Whether or not to run GLIMPSE imputation | true |
| File | query_vcf | Required if not running GLIMPSE | VCF with samples to substitute for GLIMPSE VCF output | |

## Output Parameters

| Type | Name | When | Description |
| :--- | :--- | :--- | :--- |
| File | glimpse_vcf | If run_glimpse is true | Output imputed VCF from running GLIMPSE |
| File | glimpse_vcf_index | If run_glimpse is true | Output imputer VCF index from running GLIMPSE |
| File | glimpse_qc_metrics | If run_glimpse is true and when collect_glimpse_qc = "true" | QC metrics from running GLIMPSE |
| Array[File] | glimpse_phase_monitoring | If run_glimpse is true | |
| File | glimpse_ligate_monitoring | If run_glimpse is true | |
| Array[File] | prs_raw_scores | Always | PRS raw scores |
| File | prs_mix_raw_score | Always | PRS mix raw scores |
| File | prs_adjusted_score | Always | PRS scores or mix scores adjusted with population models |
| File | pc_projection | Always | PCA projection array |
| File | pc_plot | Always | PCA plot from projection array |
| File | risk_summary | Always | TSV files with risk percentile, group, and odds ratio for the sample |
